name: Auto Assign PR to Author and Reviewers

on:
  pull_request:
    types: [opened]

jobs:
  auto-assign-author:
    runs-on: ubuntu-latest
    steps:
      - name: Auto-assign PR to author
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo, number } = context.issue;
            const { user } = context.payload.pull_request;
            
            // Check if the user is a collaborator (assignable)
            let isAssignable = false;
            try {
              // This will succeed if the user is a collaborator or has been invited
              await github.rest.repos.checkCollaborator({
                owner,
                repo,
                username: user.login
              });
              isAssignable = true;
            } catch (err) {
              if (err.status === 404) {
                console.warn(`⚠️ User ${user.login} is not a collaborator and cannot be assigned.`);
              } else {
                console.error(`❌ Error checking collaborator status for ${user.login}:`, err);
              }
            }
            
            if (isAssignable) {
              try {
                await github.rest.issues.addAssignees({
                  owner,
                  repo,
                  issue_number: number,
                  assignees: [user.login]
                });
                console.log(`✅ Assigned PR #${number} to author: ${user.login}`);
              } catch (err) {
                console.error(`❌ Failed to assign PR #${number} to ${user.login}:`, err);
              }
            }
